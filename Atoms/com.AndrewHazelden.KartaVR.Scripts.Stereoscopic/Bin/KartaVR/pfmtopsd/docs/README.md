# pfmtopsd #

----
**Version 1.0** - Released 2019-10-22  
by Andrew Hazelden  

Email: [andrew@andrewhazelden.com](mailto:andrew@andrewhazelden.com)  
Web: [www.andrewhazelden.com](http://www.andrewhazelden.com)  

Based upon original proof of concept PFM code by Paul Bourke [paul.bourke@gmail.com](mailto:paul.bourke@gmail.com)


<a name="overview"></a>
## Overview ##

The **pfmtopsd** command line tool will convert a greyscale Portable Float Map .pfm image into the 16-Bit Photoshop .psd format. The "pfmtopsd" program and source code is distributed under the MIT open source license and is included as part of the [KartaVR](http://www.andrewhazelden.com/projects/kartavr/docs/) toolset.

The .pfm image format is used to process the depth data generated by the [Facebook Surround 360](https://facebook360.fb.com/facebook-surround-360/) camera rig, and similar 6DoF depthmap capable devices like the Facebook x24 and newer camera systems. 

For a description of the pfm image structure check out this article by Paul Bourke: 

**Unofficial PBM format for HDR images, PFM (Portable Float Map)**  
[http://paulbourke.net/dataformats/pbmhdr/](http://paulbourke.net/dataformats/pbmhdr/)

## How to use pfmtopsd ##

Syntax:

> pfmtopsd input.pfm output.psd

Example:

> pfmtopsd.exe "/Media/depth.0000.pfm" > "/Media/depth.0000.psd"


## What should I do with the output? ##

After you have generated the 16 bit per channel PSD file you can convert it into a tiff image using Imagemagick's CLI (command-line_ based convert too:

> convert depth.psd depth.tiff

It's also possible to use shell pipes to streamline the process of sending pfmtopsd output to the conver tools:

## Using Pipes in the Shell ##

The pfmtopsd tool can be used with the Imagemagick graphics library to automatically convert your greyscale .pfm format depthmaps to any of the common image formats that Imagemagick supports. This more advanced example assumes you have added the pfmtopsd tool's folder and the Imagemagick convert tool's bin folder manually to your system's PATH environment variable.

Convert a PFM image to a JPEG image:

> pfmtopsd "$HOME/Desktop/pfm/depth.0000.pfm" | convert psd:- jpg:"$HOME/Desktop/pfm/image.0000.jpg"

Convert a PFM image to a PNG image:

> pfmtopsd "$HOME/Desktop/pfm/depth.0000.pfm" | convert psd:- png:"$HOME/Desktop/pfm/image.0000.png"

Convert a PFM image to a TIFF image:

> pfmtopsd "$HOME/Desktop/pfm/depth.0000.pfm" | convert psd:- tif:"$HOME/Desktop/pfm/image.0000.tif"

Convert a PFM image to an EXR image:

> pfmtopsd "$HOME/Desktop/pfm/depth.0000.pfm" | convert psd:- exr:"$HOME/Desktop/pfm/image.0000.exr"

Convert a PFM image to a TGA image:

> pfmtopsd "$HOME/Desktop/pfm/depth.0000.pfm" | convert psd:- tga:"$HOME/Desktop/pfm/image.0000.tga"


## Is there a GUI for this tool ##

Check out the KartaVR "[Convert PFM Depth Images.lua](http://www.andrewhazelden.com/projects/kartavr/docs/scripts.html#convert-pfm-depth-images)" script.

